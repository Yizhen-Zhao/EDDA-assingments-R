---
title: "Assignment_4_Group_8"
author: "Awday Korde, Xin Yang and Yalun Zheng, group 08"
date: "22 March 2018"
output: pdf_document
fontsize: 11pts
highlight: tango
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Exercise 1

Reading data from file
```{r}
data = read.table('fruitflies.txt',header = TRUE)
```
### 1.1
```{r}
data$loglongevity = log(data$longevity)
attach(data)
```

### 1.2
```{r}
par(mfrow=c(1,2))
plot(data$activity, data$loglongevity)
plot(data$thorax, data$loglongevity); abline(data$thorax, data$loglongevity)
par(mfrow=c(1,1))
pairs(data)
```
From the boxplot, we can see the group 'isolate' and 'low' are higher than the group 'high', so the life length in 'high' group are lower than other two groups. From the scatter plot, we can see the points are distributed besides the lines. But the points are distributed widely, so the linear correlation between thorax loglongevity are weak. In the scatter plot matrices, we can see the relations between two parameters. Looking at the row 4, column 3, there is a possibility activity group 2 gain higher loglongevity than other two. Looking at the row 1, column 4, it seems that thorax and loglongevity have weak linear correlations.

### 1.3
```{r}
actlm = lm(data$loglongevity~data$activity,data=data)
anova(actlm)
```
From the ANOVA output, we can see the p-value is 1.798e-07. So we reject the null hypothesis, which is there is no influence between activity and longevity. In conclusion, sexual activity influences longevity.
```{r}
summary(actlm)
```

From the summary output, we can see the null hypothesis isolate=high and low=high are all lower than 0.05, so they are all rejected. So the three groups' longevity are different.

### 1.4
```{r}
confint(actlm)
```
From the confint output, we can see the 95% confidence intervals for high is [3.4796296, 3.7246190]. For isolated-high is [0.3439909, 0.6904582], and for low-high is [0.2244780, 0.5709453]. So we can see the longevity in isolated and low are higher than the group high. And since the isolated has the highest intervals, so we can say the sexual activity decrease the longevity.

### 1.5
```{r}
acttholm = lm(data$loglongevity~data$activity+data$thorax,data=data)
anova(acttholm)
```
From the ANOVA output, we can see the p-value are 2.838e-13 and 1.139e-14. So the null hypothesis that activity and thorax has no influence in longevity are rejected. We can say both thorax and activity have influence in longevity.

### 1.6
```{r}
confint(acttholm)
```
From the confint, we can still get same conculsion as exercise 1.4. The sexual activity will decrease the longevity.

```{r}
summary(acttholm)
mean(data$thorax)
min(data$thorax)
```
Here we can see the estimate of thorax is 2.97899. And the mean of thorax is 0.8245333, the min of thorax is 0.64. So we can use these number to calculate the mean and min in the three groups.
```{r}
#For high group
mean(data$thorax)*2.97899+1.21893
#For low group
mean(data$thorax)*2.97899+1.21893+0.28570
#For isolated group
mean(data$thorax)*2.97899+1.21893+0.40998
```
So for the fly with average thorax length, the estimited longevity for high group is 3.675207, for low group is 3.960907, for isolated group is 4.085187.

```{r}
#For high group
min(data$thorax)*2.97899+1.21893
#For low group
min(data$thorax)*2.97899+1.21893+0.28570
#For isolated group
min(data$thorax)*2.97899+1.21893+0.40998
```
So for the fly with smalled thorax length, the estimited longevity for high group is 3.125484, for low group is 3.411184, for isolated group is 3.535464.

### 1.7
```{r}
par(mfrow=c(1,2))
plot(data$loglongevity~data$thorax,pch=as.character(data$activity));
qqnorm(residuals(lm(data$loglongevity~data$thorax)))
```
From the scatter plot, we can see the high group are mostly located in the lower part of graph. In the high group, with longer thorax length, the longevity are also longer. This also can be observe in other two groups, with longer thorax length the longevity will also be higher. In the normall QQ-plot, we can see a weak normality.

### 1.8
In two analysis, we would choose the one with thorax length. Because in exercise 1.5 we can see that thorax also has influence on the longevity. And in exercise 1.7, we can see how thorax length will influence the longevity. Longer thorax will increase the longevity.

We don't think any of these two analysis are wrong. Because in the first analysis, we just take one parameters into consideration, it's 1-way ANOVA. The second one is a 2-way ANOVA. They all help us get the right results. The first one is more focus on the influence of activity, the second one take them both into consideration. So the first one is more detailed on one factor, the second focus more on all aspects.

### 1.9
```{r}
par(mfrow=c(1,2))
qqnorm(residuals(acttholm));qqline(residuals(acttholm))
plot(fitted(acttholm),residuals(acttholm))
library(lmtest)
bptest(acttholm)
```
From the qqplot, we can see the deviations from the straight line are minimal. So we can say the this indicates the normal distribution. From the right side scatter plot, we can see the pionts are distributed randomly in x-axis. Check the Breusch-Pagan test results, the p-value is 0.4693, lower than 0.05. So we reject the null hypothesis. Combine the observiation from scatter plot, we will say there is no heteroscedasticity.

###1.10
```{r}
days=lm(data$longevity~data$activity+data$thorax,data=data)
anova(days)
par(mfrow=c(1,2))
qqnorm(residuals(days));qqline(residuals(days))
plot(fitted(days),residuals(days))
```
From the anova result, we can see the p-value are all lower than 0.05. So the null hypothesis are all rejected, it proves that sexual activity and thorax length all have influence on longevity. From the scatter plot, we can see the heteroscedasticity is more clear. But in the qqplot, the points are distributed in the middle part. So the normality of residuals in number of days are not as clear as in logarithm. So it may wise to use the logarithm as outcome.


## Exercise 2
```{r}
mydata=read.table("psi.txt")
```

### 2.1
```{r}
tot=xtabs(~passed+psi,data=mydata);tot
```
For analysis on the correlation between binary response variable "passed" and binary explanatory variable "psi", a table of the numbers with each possible combination is established. This table can be used for further statistical test, e.g., Fisher's test or Chi-squared test.

```{r}
xtabs(~passed+psi,data=mydata)/length(mydata[,1])
```
This is the percentaged version of the previous table.

```{r}
hist(mydata[,3],main="gpa")
```
A histogram of the distribution of numeric explanatory variable "gpa".

### 2.2
```{r}
glm1=glm(passed~psi+gpa,data=mydata,family=binomial)
glm1
```
The logistic regression model is fitted with the script above.

### 2.3
```{r}
summary(glm1)
```
According to the summary, p-value = 0.02470(<0.05), reject H0. Thus the explanatory variable "psi" has significant correlation with the response variable "passed".
```{r}
glm2=glm(passed~as.factor(psi)+gpa,data=mydata,family=binomial)
summary(glm2)
```
When the explanatory variable "psi" is taken as factor instead of numeric, the result is still the same.
Based on all the results above, "psi" can be considered as "works".

### 2.4
```{r}
newdata=data.frame(psi=1,gpa=3)
predict(glm1,newdata,type="response")
```
According to the esimation, the probability that a student with a "gpa" equal to 3 who receives "psi" passes the assignment is 0.4815864.

```{r}
newdata=data.frame(psi=0,gpa=3)
predict(glm1,newdata,type="response")
```
According to the esimation, the probability that a student with a "gpa" equal to 3 who receives "psi" passes the assignment is 0.08230274.

### 2.5
```{r}
summary(glm1)
```
According to the summary, raising "psi" by 1 increases the linear predictor by 2.338 and increases the odds of "passed" by a factor e^2.338 = 6.355. It means instructing students with psi rather than the standard method can increase the odds of passing the assignment by 6.355. It is independent to "gpa" because the predictor is linear.

### 2.6
```{r}
x=matrix(c(3,15,8,6),2,2)
fisher.test(x)
```
15 is the number of students who did not take "psi" and did not "pass" the assignment, while 6 is the number of students who did take "psi" and did not "pass" the assignment.

According to the result of the test, p-value = 0.0265(<0.05), reject H0. Thus explanatory variable "psi" has significant correlation with the response variable "passed".

### 2.7
The second approach ignores the potential correlation between response variable "passed" and explanatory variable "gpa". But when the original experiment was conducted, whether a student receives "psi" or not is independent to "gpa". Thus the second approach is correct, whereas maybe not precise.

### 2.8
#### Logistic Regression

Advantages: First of all, with logistic regression the estimations of odds increment and probability value can be calculated. And logistic regression can be applied to both categorical and numerical explanatory variables. Also logistic regression does not rely on normality of the response variable.

Disadvatages: Logistic regression may overfit the samples and assign correlations between irrelevant variables. Also it needs all the explanatory variables to be independent to each other.

#### Fisher's exact test

Advantages: Fisher's exact test works well when the sample size is relatively small, e.g., the count in cells is less than 5. And since the Fisher's exact test is carried out on 2x2 tables, there is no collinearity problems.

Disadvatages: Fisher's exact test relies on the normality hypothesis. And Fisher's exact test is not suitable for numerical variables.



## Exercise 3
```{r}
africa <- read.table("africa.txt", header = TRUE)
pairs(africa)
```

### 3.1
```{r}
par(mfrow=c(2,2))
hist(rpois(10,0.5))
hist(rpois(10,1))
hist(rpois(10,5))
hist(rpois(10,10))

hist(rpois(50,0.5))
hist(rpois(50,5))
hist(rpois(50,20))
hist(rpois(50,50))

hist(rpois(100,50))
hist(rpois(100,100))
hist(rpois(100,150))
hist(rpois(100,200))
```
In the example Poisson distributions given above, we have a random variable Y(n in our case) and a paramter $\lambda$. In Poisson distribution both mean and variance have to be equal to $\lambda$ , as observed above the higher the values we give to Y(n) the sparser the spread is, thus approximately showing itself equal to a normal distribution.From the above plots we can also observe that the higher the lambda the better the spread and the higher the likelyhood of the distrubtion to have a bell-shaped form.

### 3.2
   
The poisson regression, $\lambda$ is modelled as logarthim of a combination of numerical and/or categorical explanatory variables. For a distribution function to belong to a location scale family, a random variable X has to belong to the distribution function family as well, where Y = a + b X should also adhere to the same criteria (same family). Where for each Y the $\lambda$ parameter is modelled differently this is due to the correspondiing X being different for each iteration. 

### 3.3
```{r}
africaglm=glm(miltcoup~oligarchy+pollib+parties+pctvote+popn+size+numelec+numregim,family=poisson,data=africa)
summary(africaglm)
confint(africaglm)
coef(africaglm)
par(mfrow=c(1,3))
plot(fitted(africaglm),residuals(africaglm))
plot(log(fitted(africaglm)),residuals(africaglm))
plot(fitted(africaglm),residuals(africaglm, type = "response"))
```
Based on the scatterplots above, we plot the standardized deviance residuals against the estimated linear predictor we observe that the respone variable is steady and somewhat normally-distributed. The deviance (residuals) in our case is used to properly assess the goodness of the fit model, where the lower the deviance the better the fit of the model.
There are no clear patterns or trends seen in the residuals that would show signs of non-linearity.

### 3.4
```{r}
summary(lm(miltcoup~oligarchy+pollib+parties+pctvote+popn+size+numelec+numregim,data=africa))

summary(lm(miltcoup~oligarchy+pollib+parties+pctvote+popn+size+numelec,data=africa))

summary(lm(miltcoup~oligarchy+pollib+parties+pctvote+popn+size,data=africa))

summary(lm(miltcoup~oligarchy+pollib+parties+popn+size,data=africa))

summary(lm(miltcoup~oligarchy+pollib+parties+popn,data=africa))

summary(lm(miltcoup~oligarchy+pollib+parties,data=africa))
```
### 3.5
```{r}
africalm = lm(miltcoup~oligarchy+pollib+parties,data=africa)
africalm
```
Scatter plot of residuals against each X k in the model separately

```{r}
par(mfrow=c(1,3))
plot(residuals(africalm),africa$oligarchy);
plot(residuals(africalm),africa$pollib);
plot(residuals(africalm),africa$parties);
```
Scatter plot of residuals against each X k not in the model separately
```{r}
par(mfrow=c(1,3))

plot(residuals(africalm),africa$numregim)
plot(residuals(africalm),africa$numelec)
plot(residuals(africalm),africa$size)
par(mfrow=c(1,2))
plot(residuals(africalm),africa$pctvote)
plot(residuals(africalm),africa$popn)
```
Scatter plot of residuals against Y
```{r}
par(mfrow=c(1,2))
plot(residuals(africalm),africa$miltcoup)
plot(residuals(africalm),fitted(africalm))
```
Q-Q plot of the residuals
```{r}
par(mfrow=c(1,1))
qqnorm(residuals(africalm))
```
Both explanatory variables and response variables dont show any sign of patterns or trends, showing only signs of strong non-linear patterns. The q-q plot is shown to have a evenly distributed form with no other patterns shown.